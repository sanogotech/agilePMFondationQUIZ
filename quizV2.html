<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgilePM Foundation v3 - Advanced Assessment V2</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --agile-purple: #8e44ad;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-bg: #f8f9fa;
            --white-color: #ffffff;
            --grey-text: #7f8c8d;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--primary-color);
            min-height: 100vh;
            padding-top: 2rem;
        }

        .quiz-container {
            max-width: 900px;
            margin: auto;
            background-color: var(--white-color);
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .quiz-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--agile-purple), var(--secondary-color));
        }

        .quiz-header h1 {
            color: var(--primary-color);
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .quiz-header p {
            text-align: center;
            color: var(--grey-text);
            margin-bottom: 2rem;
        }

        .difficulty-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .version-badge {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-left: 0.5rem;
        }

        .progress-container {
            margin-bottom: 1.5rem;
        }

        #question-counter {
            font-weight: 600;
            color: var(--secondary-color);
        }

        #question-card {
            border: none;
            border-radius: 10px;
            padding: 2rem;
            background-color: #fdfdfd;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--agile-purple);
        }
        
        #question-text {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 1rem 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1rem;
            border-radius: 8px;
            border: 2px solid #ecf0f1;
            background-color: var(--white-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .option-btn:hover:not([disabled]) {
            border-color: var(--agile-purple);
            background-color: #f8f5ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .option-btn.correct {
            background-color: #e9f7ef;
            border-color: var(--success-color);
            color: var(--success-color);
            font-weight: 600;
        }

        .option-btn.incorrect {
            background-color: #fdeded;
            border-color: var(--danger-color);
            color: var(--danger-color);
            font-weight: 600;
        }

        #explanation-box {
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            animation: fadeIn 0.5s ease;
        }
        
        #explanation-box h5 {
            font-weight: 700;
        }

        .explanation-correct {
             background-color: #e9f7ef;
             border-left: 5px solid var(--success-color);
        }

        .explanation-incorrect {
            background-color: #fdeded;
            border-left: 5px solid var(--danger-color);
        }

        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
        }

        .nav-btn {
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Modal styling */
        .modal-header {
            background: linear-gradient(135deg, var(--agile-purple), #6c5ce7);
            color: var(--white-color);
        }

        .modal-title-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }
        
        .final-score {
            font-size: 3.5rem;
            font-weight: 700;
        }
        
        .score-text {
            font-size: 1.5rem;
        }
        
        .exam-info {
            background-color: #e8f4fd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--secondary-color);
        }

        .chapter-analysis {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .chapter-progress {
            height: 8px;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .strength-weakness {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .strength {
            background-color: #e9f7ef;
            border-left: 4px solid var(--success-color);
        }

        .weakness {
            background-color: #fdeded;
            border-left: 4px solid var(--danger-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="quiz-container">
            <div class="quiz-header">
                <h1><i class="fas fa-graduation-cap" style="color:var(--agile-purple);"></i> AgilePM Foundation v3 - Advanced Assessment</h1>
                <p>Version 2 - 25 new challenging questions to evaluate your AgilePM expertise</p>
                <div class="text-center">
                    <span class="difficulty-badge"><i class="fas fa-fire"></i> ADVANCED LEVEL</span>
                    <span class="version-badge"><i class="fas fa-code-branch"></i> VERSION 2</span>
                </div>
            </div>
            
            <div class="exam-info">
                <h5><i class="fas fa-info-circle"></i> Assessment Details</h5>
                <p class="mb-1"><strong>Format:</strong> 25 challenging multiple-choice questions</p>
                <p class="mb-1"><strong>Focus:</strong> Deep understanding of AgilePM concepts</p>
                <p class="mb-0"><strong>Outcome:</strong> Detailed chapter analysis with recommendations</p>
            </div>

            <div class="progress-container">
                 <div class="d-flex justify-content-between align-items-center mb-1">
                    <span id="question-counter">Question 1 / 25</span>
                    <span id="current-score">Score: 0</span>
                 </div>
                <div class="progress" style="height: 10px;">
                    <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 4%; background: linear-gradient(90deg, var(--agile-purple), var(--secondary-color));" aria-valuenow="4" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div id="question-card" class="card">
                <div class="card-body">
                    <h2 id="question-text">Loading question...</h2>
                    <div id="options-container">
                        <!-- Option buttons will be inserted here by JavaScript -->
                    </div>
                    <div id="explanation-box" class="d-none">
                        <h5 id="explanation-title"></h5>
                        <p id="explanation-text"></p>
                    </div>
                </div>
            </div>

            <div class="quiz-navigation">
                <button id="prev-btn" class="btn btn-outline-secondary nav-btn" disabled><i class="fas fa-arrow-left"></i> Previous</button>
                <button id="next-btn" class="btn btn-primary nav-btn">Next <i class="fas fa-arrow-right"></i></button>
                <button id="finish-btn" class="btn btn-success nav-btn d-none pulse">Finish & View Analysis</button>
            </div>
        </div>
    </div>

    <!-- Modal for results -->
    <div class="modal fade" id="resultsModal" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultsModalLabel"><i class="fas fa-chart-bar modal-title-icon"></i>Advanced Assessment Results - V2</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <h4 class="score-text">Your Performance Score:</h4>
                        <p class="final-score" id="final-score-percentage">0%</p>
                        <p class="text-muted fs-5">
                            <span id="final-score-correct">0</span> out of 
                            <span id="final-score-total">0</span> correct answers
                        </p>
                        <div id="pass-fail-message" class="mt-3"></div>
                    </div>
                    
                    <hr>
                    
                    <h5 class="mb-3"><i class="fas fa-analytics"></i> Chapter Performance Analysis</h5>
                    <div id="chapter-analysis-container"></div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check-circle text-success"></i> Key Strengths</h6>
                            <div id="strengths-list"></div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-exclamation-triangle text-danger"></i> Areas for Improvement</h6>
                            <div id="weaknesses-list"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6><i class="fas fa-lightbulb text-warning"></i> Recommendations</h6>
                        <div id="final-recommendations"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="restart-quiz-btn"><i class="fas fa-redo"></i> Retake Assessment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const quizData = {
            questions: [
                // AgilePM Principles (Advanced Questions - V2)
                {
                    question: "Which AgilePM principle is most directly demonstrated when a team decides to de-scope a Should Have requirement to ensure on-time delivery of all Must Haves?",
                    options: [
                        "Focus on the business need",
                        "Deliver on time",
                        "Never compromise quality", 
                        "Build incrementally from firm foundations"
                    ],
                    correctAnswer: "Deliver on time",
                    explanation: "The 'Deliver on time' principle prioritizes meeting commitments over delivering all desired functionality, using MoSCoW prioritization to make strategic scope decisions.",
                    chapter: "Principles"
                },
                {
                    question: "A project team is facing pressure to reduce testing time to meet a deadline. Applying the 'Never compromise quality' principle, what should be their response?",
                    options: [
                        "Reduce testing but increase documentation",
                        "De-scope lower priority requirements instead",
                        "Extend the timeline to maintain quality standards",
                        "Accept the risk and proceed with reduced testing"
                    ],
                    correctAnswer: "De-scope lower priority requirements instead",
                    explanation: "The 'Never compromise quality' principle means maintaining quality standards by adjusting scope (using MoSCoW) rather than sacrificing quality.",
                    chapter: "Principles"
                },
                {
                    question: "How does the 'Develop iteratively' principle help manage project risks?",
                    options: [
                        "By eliminating the need for risk management processes",
                        "By providing frequent opportunities to identify and address risks",
                        "By ensuring all risks are identified before development begins",
                        "By transferring all risks to the business stakeholders"
                    ],
                    correctAnswer: "By providing frequent opportunities to identify and address risks",
                    explanation: "Iterative development creates regular checkpoints where new risks can be identified and existing risks can be reassessed and mitigated.",
                    chapter: "Principles"
                },
                
                // Lifecycle Phases (Advanced Questions - V2)
                {
                    question: "What is the primary purpose of the Feasibility phase in relation to business objectives?",
                    options: [
                        "To create a detailed project plan",
                        "To confirm the project aligns with strategic business goals",
                        "To develop the initial solution architecture",
                        "To establish the development team structure"
                    ],
                    correctAnswer: "To confirm the project aligns with strategic business goals",
                    explanation: "The Feasibility phase validates that the project is both technically possible and strategically aligned with business objectives before significant investment.",
                    chapter: "Lifecycle"
                },
                {
                    question: "During which phase would you expect the most significant changes to the Management Approach Definition?",
                    options: [
                        "Feasibility phase",
                        "Foundations phase", 
                        "Early Exploration phase",
                        "Post-project phase"
                    ],
                    correctAnswer: "Early Exploration phase",
                    explanation: "The Management Approach often requires refinement during early Exploration as the team gains practical experience with the project's unique challenges and dynamics.",
                    chapter: "Lifecycle"
                },
                {
                    question: "What distinguishes the Deployment phase from the Engineering phase in terms of stakeholder focus?",
                    options: [
                        "Deployment focuses on technical quality while Engineering focuses on business value",
                        "Deployment involves end-users while Engineering involves developers",
                        "Deployment prepares for business operation while Engineering prepares for testing",
                        "There is no significant difference in stakeholder focus"
                    ],
                    correctAnswer: "Deployment prepares for business operation while Engineering prepares for testing",
                    explanation: "Engineering focuses on developing and testing the solution, while Deployment focuses on transitioning the solution to live operation and business use.",
                    chapter: "Lifecycle"
                },
                
                // Roles & Responsibilities (Advanced Questions - V2)
                {
                    question: "Which role has the primary responsibility for ensuring that the solution meets actual business needs rather than just documented requirements?",
                    options: [
                        "Business Analyst",
                        "Business Visionary", 
                        "Business Ambassador",
                        "Solution Developer"
                    ],
                    correctAnswer: "Business Ambassador",
                    explanation: "The Business Ambassador works closely with the development team to ensure the emerging solution genuinely addresses business needs, not just specified requirements.",
                    chapter: "Roles"
                },
                {
                    question: "In a conflict between technical best practices and business priorities, which role should facilitate the resolution?",
                    options: [
                        "Technical Coordinator",
                        "Business Visionary",
                        "Project Manager", 
                        "Team Leader"
                    ],
                    correctAnswer: "Project Manager",
                    explanation: "The Project Manager facilitates resolution of conflicts between technical and business perspectives, ensuring decisions balance both concerns appropriately.",
                    chapter: "Roles"
                },
                {
                    question: "Which role is primarily responsible for maintaining the technical consistency of the solution across multiple teams?",
                    options: [
                        "Technical Coordinator", 
                        "Team Leader",
                        "Solution Developer",
                        "Business Analyst"
                    ],
                    correctAnswer: "Technical Coordinator",
                    explanation: "The Technical Coordinator ensures technical consistency and coherence across the solution, particularly important in multi-team environments.",
                    chapter: "Roles"
                },
                
                // Products & Artifacts (Advanced Questions - V2)
                {
                    question: "What is the relationship between the Business Case and the Benefits Assessment throughout the project lifecycle?",
                    options: [
                        "The Business Case replaces the Benefits Assessment after Foundations",
                        "The Benefits Assessment validates assumptions in the Business Case",
                        "They are the same document with different names",
                        "The Benefits Assessment is only used if the Business Case is weak"
                    ],
                    correctAnswer: "The Benefits Assessment validates assumptions in the Business Case",
                    explanation: "The Benefits Assessment actively tests and validates the benefit assumptions made in the Business Case as the project delivers increments.",
                    chapter: "Products"
                },
                {
                    question: "Which artifact provides the definitive reference for what constitutes 'done' for any deliverable?",
                    options: [
                        "Prioritized Requirements List",
                        "Solution Architecture Definition", 
                        "Quality Management Approach",
                        "Timebox Plan"
                    ],
                    correctAnswer: "Quality Management Approach",
                    explanation: "The Quality Management Approach defines the standards and criteria that determine when work is complete and of sufficient quality.",
                    chapter: "Products"
                },
                {
                    question: "How does the Delivery Plan differ from individual Timebox Plans?",
                    options: [
                        "The Delivery Plan contains detailed tasks while Timebox Plans contain high-level milestones",
                        "The Delivery Plan covers the entire project while Timebox Plans cover specific iterations",
                        "There is no significant difference between them",
                        "The Delivery Plan is for stakeholders while Timebox Plans are for the team"
                    ],
                    correctAnswer: "The Delivery Plan covers the entire project while Timebox Plans cover specific iterations",
                    explanation: "The Delivery Plan provides the high-level project roadmap, while Timebox Plans detail specific work for each iteration within that roadmap.",
                    chapter: "Products"
                },
                
                // Planning & Control (Advanced Questions - V2)
                {
                    question: "What is the primary value of using timeboxing in AgilePM planning?",
                    options: [
                        "It eliminates the need for detailed estimation",
                        "It creates fixed deadlines that cannot be changed",
                        "It provides regular checkpoints for inspection and adaptation",
                        "It ensures all work is completed in sequence"
                    ],
                    correctAnswer: "It provides regular checkpoints for inspection and adaptation",
                    explanation: "Timeboxing creates natural rhythm and regular opportunities to inspect progress, gather feedback, and adapt plans based on learning.",
                    chapter: "Planning"
                },
                {
                    question: "How should contingency be managed within an AgilePM timebox?",
                    options: [
                        "By including buffer time for each task",
                        "Through the MoSCoW prioritization of requirements", 
                        "By having a separate contingency timebox",
                        "Contingency is not needed in AgilePM"
                    ],
                    correctAnswer: "Through the MoSCoW prioritization of requirements",
                    explanation: "In AgilePM, contingency is built into the prioritization - Should Have and Could Have requirements provide flexibility to accommodate uncertainty.",
                    chapter: "Planning"
                },
                {
                    question: "What is the primary purpose of establishing tolerances at different planning levels?",
                    options: [
                        "To create bureaucratic approval processes",
                        "To enable management by exception", 
                        "To eliminate all project risks",
                        "To ensure perfect plan accuracy"
                    ],
                    correctAnswer: "To enable management by exception",
                    explanation: "Tolerances define boundaries within which teams can operate autonomously, with escalation only required when boundaries are threatened.",
                    chapter: "Planning"
                },
                
                // Risk & Quality (Advanced Questions - V2)
                {
                    question: "How does AgilePM's approach to quality assurance differ from traditional phased approaches?",
                    options: [
                        "Quality is considered less important than speed",
                        "Quality activities are integrated throughout the project", 
                        "Quality is only assessed at the end of the project",
                        "Quality is the sole responsibility of a separate QA team"
                    ],
                    correctAnswer: "Quality activities are integrated throughout the project",
                    explanation: "AgilePM embeds quality activities throughout development via continuous testing, reviews, and validation rather than treating quality as a separate phase.",
                    chapter: "Quality"
                },
                {
                    question: "Which risk response strategy is most aligned with AgilePM when facing uncertain user requirements?",
                    options: [
                        "Avoidance - don't implement uncertain requirements",
                        "Mitigation - develop prototypes and gather early feedback", 
                        "Transfer - make the business stakeholders responsible",
                        "Acceptance - document the uncertainty and proceed"
                    ],
                    correctAnswer: "Mitigation - develop prototypes and gather early feedback",
                    explanation: "AgilePM favors active risk mitigation through iterative development, early feedback, and empirical validation of requirements.",
                    chapter: "Risk"
                },
                {
                    question: "What is the primary purpose of the 'Definition of Done' in managing quality expectations?",
                    options: [
                        "To document completed work for auditors",
                        "To create a shared understanding of quality standards", 
                        "To measure individual developer productivity",
                        "To provide a checklist for project closure"
                    ],
                    correctAnswer: "To create a shared understanding of quality standards",
                    explanation: "The Definition of Done establishes clear, shared criteria that ensure consistent understanding of what 'done' means across the team.",
                    chapter: "Quality"
                },
                
                // Governance & Controls (Advanced Questions - V2)
                {
                    question: "Which governance mechanism provides the most timely indication of emerging project issues?",
                    options: [
                        "Monthly steering committee meetings",
                        "End-of-timebox reviews", 
                        "Daily stand-ups",
                        "Formal change control boards"
                    ],
                    correctAnswer: "Daily stand-ups",
                    explanation: "Daily stand-ups provide immediate visibility into emerging issues, enabling rapid response before problems escalate.",
                    chapter: "Governance"
                },
                {
                    question: "How does AgilePM's control approach differ from traditional command-and-control methods?",
                    options: [
                        "It eliminates all controls for maximum flexibility",
                        "It uses empirical data and frequent inspection for control", 
                        "It relies on detailed upfront planning for control",
                        "It transfers all control to the development team"
                    ],
                    correctAnswer: "It uses empirical data and frequent inspection for control",
                    explanation: "AgilePM controls through frequent inspection of working solutions and adaptation based on empirical data rather than adherence to predetermined plans.",
                    chapter: "Governance"
                },
                {
                    question: "What is the primary value of timeboxing in project governance?",
                    options: [
                        "It creates rigid deadlines that cannot be changed",
                        "It provides predictable rhythm for decision-making", 
                        "It eliminates the need for other governance mechanisms",
                        "It ensures all work is completed exactly as planned"
                    ],
                    correctAnswer: "It provides predictable rhythm for decision-making",
                    explanation: "Timeboxing creates regular, predictable intervals for review, decision-making, and course correction throughout the project.",
                    chapter: "Governance"
                },
                
                // Communication & Workshops (Advanced Questions - V2)
                {
                    question: "What distinguishes an AgilePM facilitated workshop from a traditional meeting?",
                    options: [
                        "Facilitated workshops are always longer",
                        "Facilitated workshops use structured techniques for collaboration", 
                        "Facilitated workshops only include senior stakeholders",
                        "There is no significant difference"
                    ],
                    correctAnswer: "Facilitated workshops use structured techniques for collaboration",
                    explanation: "Facilitated workshops employ specific techniques and a trained facilitator to ensure productive collaboration and effective outcomes.",
                    chapter: "Communication"
                },
                {
                    question: "Which communication approach is most effective for distributed AgilePM teams?",
                    options: [
                        "Rely primarily on detailed documentation",
                        "Use rich communication media appropriate to each context", 
                        "Limit communication to scheduled formal meetings",
                        "Assign a single communication coordinator"
                    ],
                    correctAnswer: "Use rich communication media appropriate to each context",
                    explanation: "Effective distributed communication uses the richest medium appropriate for each interaction, balancing richness with practicality.",
                    chapter: "Communication"
                },
                {
                    question: "What is the primary purpose of the Daily Stand-up in an AgilePM project?",
                    options: [
                        "To provide detailed status reporting to management",
                        "To solve complex technical problems",
                        "To synchronize the team and plan immediate work", 
                        "To assign specific tasks to team members"
                    ],
                    correctAnswer: "To synchronize the team and plan immediate work",
                    explanation: "The Daily Stand-up focuses on team synchronization and planning the next 24 hours, not detailed reporting or problem-solving.",
                    chapter: "Communication"
                },
                {
                    question: "Which factor is most critical for effective workshop outcomes in AgilePM?",
                    options: [
                        "The facilitator's technical expertise",
                        "Comprehensive pre-workshop documentation", 
                        "Inclusive participation and psychological safety",
                        "Strict adherence to the agenda without deviation"
                    ],
                    correctAnswer: "Inclusive participation and psychological safety",
                    explanation: "Psychological safety and inclusive participation enable open discussion and collaborative problem-solving, which are essential for effective workshops.",
                    chapter: "Communication"
                }
            ]
        };

        // DOM Elements
        const questionCounterEl = document.getElementById('question-counter');
        const currentScoreEl = document.getElementById('current-score');
        const progressBarEl = document.getElementById('progress-bar');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const explanationBoxEl = document.getElementById('explanation-box');
        const explanationTitleEl = document.getElementById('explanation-title');
        const explanationTextEl = document.getElementById('explanation-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const finishBtn = document.getElementById('finish-btn');
        
        // Modal Elements
        const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
        const finalScoreCorrectEl = document.getElementById('final-score-correct');
        const finalScoreTotalEl = document.getElementById('final-score-total');
        const finalScorePercentageEl = document.getElementById('final-score-percentage');
        const finalRecommendationsEl = document.getElementById('final-recommendations');
        const passFailMessageEl = document.getElementById('pass-fail-message');
        const chapterAnalysisContainer = document.getElementById('chapter-analysis-container');
        const strengthsList = document.getElementById('strengths-list');
        const weaknessesList = document.getElementById('weaknesses-list');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');

        // Quiz State
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let questions = [];
        let chapterPerformance = {};

        function initializeChapterPerformance() {
            const chapters = ["Principles", "Lifecycle", "Roles", "Products", "Planning", "Quality", "Risk", "Governance", "Communication"];
            chapterPerformance = {};
            chapters.forEach(chapter => {
                chapterPerformance[chapter] = {
                    correct: 0,
                    total: 0,
                    percentage: 0
                };
            });
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startQuiz() {
            questions = shuffleArray([...quizData.questions]);
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = new Array(questions.length).fill(null);
            initializeChapterPerformance();
            displayQuestion(currentQuestionIndex);
            updateScoreDisplay();
            resultsModal.hide();
        }

        function displayQuestion(index) {
            // Hide explanation from previous question
            explanationBoxEl.classList.add('d-none');
            
            const question = questions[index];
            questionTextEl.textContent = question.question;
            
            // Clear previous options
            optionsContainerEl.innerHTML = '';
            
            // Display options
            question.options.forEach(optionText => {
                const button = document.createElement('button');
                button.textContent = optionText;
                button.classList.add('btn', 'option-btn');
                button.onclick = () => selectAnswer(button, optionText, index);
                optionsContainerEl.appendChild(button);
            });
            
            updateNavigation();
            updateProgressBar();
            
            // If the user has already answered this question, show their answer
            if (userAnswers[index] !== null) {
                showAnswerFeedback(index);
            }
        }
        
        function selectAnswer(button, selectedAnswer, questionIndex) {
            // Prevent re-answering
            if (userAnswers[questionIndex] !== null) return;
            
            const question = questions[questionIndex];
            const isCorrect = selectedAnswer === question.correctAnswer;
            
            userAnswers[questionIndex] = {
                selected: selectedAnswer,
                correct: question.correctAnswer,
                isCorrect: isCorrect,
                chapter: question.chapter
            };
            
            // Update chapter performance
            chapterPerformance[question.chapter].total++;
            if(isCorrect) {
                score++;
                chapterPerformance[question.chapter].correct++;
            }
            
            updateScoreDisplay();
            showAnswerFeedback(questionIndex);
        }

        function showAnswerFeedback(index) {
            const userAnswer = userAnswers[index];
            if (!userAnswer) return;

            const question = questions[index];

            // Disable all option buttons
            const optionButtons = optionsContainerEl.querySelectorAll('.option-btn');
            optionButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === userAnswer.correct) {
                    btn.classList.add('correct');
                } else if (btn.textContent === userAnswer.selected) {
                    btn.classList.add('incorrect');
                }
            });

            // Show explanation
            explanationTextEl.textContent = question.explanation;
            if (userAnswer.isCorrect) {
                explanationTitleEl.textContent = "Correct!";
                explanationBoxEl.className = 'explanation-correct';
            } else {
                explanationTitleEl.textContent = "Explanation:";
                explanationBoxEl.className = 'explanation-incorrect';
            }
            explanationBoxEl.classList.remove('d-none');
        }

        function updateNavigation() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.classList.toggle('d-none', currentQuestionIndex === questions.length - 1);
            finishBtn.classList.toggle('d-none', currentQuestionIndex !== questions.length - 1);
        }

        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBarEl.style.width = `${progress}%`;
            progressBarEl.setAttribute('aria-valuenow', progress);
            questionCounterEl.textContent = `Question ${currentQuestionIndex + 1} / ${questions.length}`;
        }
        
        function updateScoreDisplay() {
            currentScoreEl.textContent = `Score: ${score}`;
        }

        function handleNext() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
            }
        }

        function handlePrev() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex);
            }
        }

        function calculateChapterPerformance() {
            // Calculate percentages for each chapter
            Object.keys(chapterPerformance).forEach(chapter => {
                const data = chapterPerformance[chapter];
                if (data.total > 0) {
                    data.percentage = Math.round((data.correct / data.total) * 100);
                }
            });
        }

        function getPerformanceColor(percentage) {
            if (percentage >= 80) return 'success';
            if (percentage >= 60) return 'warning';
            return 'danger';
        }

        function showFinalResults() {
            calculateChapterPerformance();
            const percentage = (score / questions.length) * 100;
            const passed = percentage >= 70; // Higher threshold for advanced assessment
            let scoreColor;
            let recommendationsHtml;
            let passFailHtml;

            if (passed) {
                scoreColor = 'var(--success-color)';
                passFailHtml = '<div class="alert alert-success"><i class="fas fa-trophy"></i> <strong>Excellent!</strong> You demonstrate advanced AgilePM knowledge.</div>';
                recommendationsHtml = '<p>Your performance indicates strong understanding of AgilePM concepts. Consider preparing for the Practitioner level certification.</p>';
            } else {
                scoreColor = 'var(--danger-color)';
                passFailHtml = '<div class="alert alert-danger"><i class="fas fa-graduation-cap"></i> <strong>Good effort!</strong> Focus on the identified improvement areas.</div>';
                recommendationsHtml = '<p>Review the AgilePM Foundation syllabus with special attention to your weaker areas. Practice with more scenario-based questions.</p>';
            }

            finalScoreCorrectEl.textContent = score;
            finalScoreTotalEl.textContent = questions.length;
            finalScorePercentageEl.textContent = `${percentage.toFixed(0)}%`;
            finalScorePercentageEl.style.color = scoreColor;
            passFailMessageEl.innerHTML = passFailHtml;
            finalRecommendationsEl.innerHTML = recommendationsHtml;

            // Generate chapter analysis
            generateChapterAnalysis();
            
            // Generate strengths and weaknesses
            generateStrengthsWeaknesses();

            resultsModal.show();
        }

        function generateChapterAnalysis() {
            let analysisHtml = '<div class="chapter-analysis">';
            
            Object.keys(chapterPerformance).forEach(chapter => {
                const data = chapterPerformance[chapter];
                if (data.total > 0) {
                    const color = getPerformanceColor(data.percentage);
                    analysisHtml += `
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>${chapter}</span>
                                <span class="fw-bold text-${color}">${data.percentage}%</span>
                            </div>
                            <div class="progress chapter-progress">
                                <div class="progress-bar bg-${color}" role="progressbar" style="width: ${data.percentage}%" aria-valuenow="${data.percentage}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small class="text-muted">${data.correct}/${data.total} correct</small>
                        </div>
                    `;
                }
            });
            
            analysisHtml += '</div>';
            chapterAnalysisContainer.innerHTML = analysisHtml;
        }

        function generateStrengthsWeaknesses() {
            let strengthsHtml = '';
            let weaknessesHtml = '';
            
            Object.keys(chapterPerformance).forEach(chapter => {
                const data = chapterPerformance[chapter];
                if (data.total > 0) {
                    if (data.percentage >= 80) {
                        strengthsHtml += `<div class="strength-weakness strength">${chapter} (${data.percentage}%)</div>`;
                    } else if (data.percentage < 60) {
                        weaknessesHtml += `<div class="strength-weakness weakness">${chapter} (${data.percentage}%)</div>`;
                    }
                }
            });
            
            if (strengthsHtml === '') {
                strengthsHtml = '<div class="text-muted">No clear strengths identified. Focus on fundamental concepts.</div>';
            }
            
            if (weaknessesHtml === '') {
                weaknessesHtml = '<div class="text-muted">No major weaknesses identified. Good overall understanding.</div>';
            }
            
            strengthsList.innerHTML = strengthsHtml;
            weaknessesList.innerHTML = weaknessesHtml;
        }

        // Event Listeners
        nextBtn.addEventListener('click', handleNext);
        prevBtn.addEventListener('click', handlePrev);
        finishBtn.addEventListener('click', showFinalResults);
        restartQuizBtn.addEventListener('click', () => {
            resultsModal.hide();
            // A short delay to allow modal to close before restarting
            setTimeout(startQuiz, 500);
        });
        
        // Initial call
        document.addEventListener('DOMContentLoaded', startQuiz);
    </script>
</body>
</html>
