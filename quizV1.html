<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgilePM Foundation v3 - Advanced Assessment</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --agile-purple: #8e44ad;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-bg: #f8f9fa;
            --white-color: #ffffff;
            --grey-text: #7f8c8d;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--primary-color);
            min-height: 100vh;
            padding-top: 2rem;
        }

        .quiz-container {
            max-width: 900px;
            margin: auto;
            background-color: var(--white-color);
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .quiz-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--agile-purple), var(--secondary-color));
        }

        .quiz-header h1 {
            color: var(--primary-color);
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .quiz-header p {
            text-align: center;
            color: var(--grey-text);
            margin-bottom: 2rem;
        }

        .difficulty-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .progress-container {
            margin-bottom: 1.5rem;
        }

        #question-counter {
            font-weight: 600;
            color: var(--secondary-color);
        }

        #question-card {
            border: none;
            border-radius: 10px;
            padding: 2rem;
            background-color: #fdfdfd;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--agile-purple);
        }
        
        #question-text {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 1rem 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1rem;
            border-radius: 8px;
            border: 2px solid #ecf0f1;
            background-color: var(--white-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .option-btn:hover:not([disabled]) {
            border-color: var(--agile-purple);
            background-color: #f8f5ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .option-btn.correct {
            background-color: #e9f7ef;
            border-color: var(--success-color);
            color: var(--success-color);
            font-weight: 600;
        }

        .option-btn.incorrect {
            background-color: #fdeded;
            border-color: var(--danger-color);
            color: var(--danger-color);
            font-weight: 600;
        }

        #explanation-box {
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            animation: fadeIn 0.5s ease;
        }
        
        #explanation-box h5 {
            font-weight: 700;
        }

        .explanation-correct {
             background-color: #e9f7ef;
             border-left: 5px solid var(--success-color);
        }

        .explanation-incorrect {
            background-color: #fdeded;
            border-left: 5px solid var(--danger-color);
        }

        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
        }

        .nav-btn {
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Modal styling */
        .modal-header {
            background: linear-gradient(135deg, var(--agile-purple), #6c5ce7);
            color: var(--white-color);
        }

        .modal-title-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }
        
        .final-score {
            font-size: 3.5rem;
            font-weight: 700;
        }
        
        .score-text {
            font-size: 1.5rem;
        }
        
        .exam-info {
            background-color: #e8f4fd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--secondary-color);
        }

        .chapter-analysis {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .chapter-progress {
            height: 8px;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .strength-weakness {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .strength {
            background-color: #e9f7ef;
            border-left: 4px solid var(--success-color);
        }

        .weakness {
            background-color: #fdeded;
            border-left: 4px solid var(--danger-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="quiz-container">
            <div class="quiz-header">
                <h1><i class="fas fa-graduation-cap" style="color:var(--agile-purple);"></i> AgilePM Foundation v3 - Advanced Assessment</h1>
                <p>Advanced 25-question assessment to evaluate your AgilePM knowledge and identify strengths/weaknesses</p>
                <div class="text-center">
                    <span class="difficulty-badge"><i class="fas fa-fire"></i> ADVANCED LEVEL</span>
                </div>
            </div>
            
            <div class="exam-info">
                <h5><i class="fas fa-info-circle"></i> Assessment Details</h5>
                <p class="mb-1"><strong>Format:</strong> 25 challenging multiple-choice questions</p>
                <p class="mb-1"><strong>Focus:</strong> Deep understanding of AgilePM concepts</p>
                <p class="mb-0"><strong>Outcome:</strong> Detailed chapter analysis with recommendations</p>
            </div>

            <div class="progress-container">
                 <div class="d-flex justify-content-between align-items-center mb-1">
                    <span id="question-counter">Question 1 / 25</span>
                    <span id="current-score">Score: 0</span>
                 </div>
                <div class="progress" style="height: 10px;">
                    <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 4%; background: linear-gradient(90deg, var(--agile-purple), var(--secondary-color));" aria-valuenow="4" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div id="question-card" class="card">
                <div class="card-body">
                    <h2 id="question-text">Loading question...</h2>
                    <div id="options-container">
                        <!-- Option buttons will be inserted here by JavaScript -->
                    </div>
                    <div id="explanation-box" class="d-none">
                        <h5 id="explanation-title"></h5>
                        <p id="explanation-text"></p>
                    </div>
                </div>
            </div>

            <div class="quiz-navigation">
                <button id="prev-btn" class="btn btn-outline-secondary nav-btn" disabled><i class="fas fa-arrow-left"></i> Previous</button>
                <button id="next-btn" class="btn btn-primary nav-btn">Next <i class="fas fa-arrow-right"></i></button>
                <button id="finish-btn" class="btn btn-success nav-btn d-none pulse">Finish & View Analysis</button>
            </div>
        </div>
    </div>

    <!-- Modal for results -->
    <div class="modal fade" id="resultsModal" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultsModalLabel"><i class="fas fa-chart-bar modal-title-icon"></i>Advanced Assessment Results</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <h4 class="score-text">Your Performance Score:</h4>
                        <p class="final-score" id="final-score-percentage">0%</p>
                        <p class="text-muted fs-5">
                            <span id="final-score-correct">0</span> out of 
                            <span id="final-score-total">0</span> correct answers
                        </p>
                        <div id="pass-fail-message" class="mt-3"></div>
                    </div>
                    
                    <hr>
                    
                    <h5 class="mb-3"><i class="fas fa-analytics"></i> Chapter Performance Analysis</h5>
                    <div id="chapter-analysis-container"></div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check-circle text-success"></i> Key Strengths</h6>
                            <div id="strengths-list"></div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-exclamation-triangle text-danger"></i> Areas for Improvement</h6>
                            <div id="weaknesses-list"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6><i class="fas fa-lightbulb text-warning"></i> Recommendations</h6>
                        <div id="final-recommendations"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="restart-quiz-btn"><i class="fas fa-redo"></i> Retake Assessment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const quizData = {
            questions: [
                // AgilePM Principles (Advanced Questions)
                {
                    question: "In AgilePM, which principle is most directly challenged when a stakeholder insists on adding 'just one more' Must Have requirement late in the project without adjusting the timeline?",
                    options: [
                        "Focus on the business need",
                        "Deliver on time", 
                        "Never compromise quality",
                        "Build incrementally from firm foundations"
                    ],
                    correctAnswer: "Deliver on time",
                    explanation: "The 'Deliver on time' principle is challenged when scope is increased without adjusting timelines. AgilePM emphasizes fixed timeboxes and using MoSCoW prioritization to manage scope changes.",
                    chapter: "Principles"
                },
                {
                    question: "A project team is consistently delivering Could Have requirements but struggling with Should Have items. Which AgilePM principle is most at risk?",
                    options: [
                        "Collaborate",
                        "Develop iteratively", 
                        "Demonstrate control",
                        "Never compromise quality"
                    ],
                    correctAnswer: "Demonstrate control",
                    explanation: "When teams deliver lower-priority items before higher-priority ones, it indicates a lack of control over the delivery process and prioritization.",
                    chapter: "Principles"
                },
                {
                    question: "Which scenario best exemplifies the principle 'Communicate continuously and clearly' in an AgilePM context?",
                    options: [
                        "The Business Visionary provides detailed written specifications at the start of each timebox",
                        "The Team Leader sends weekly status reports to all stakeholders",
                        "The Business Ambassador works collocated with the development team and participates in daily stand-ups",
                        "The Project Manager holds monthly steering committee meetings"
                    ],
                    correctAnswer: "The Business Ambassador works collocated with the development team and participates in daily stand-ups",
                    explanation: "Continuous, clear communication is best achieved through direct collaboration and frequent interactions, not just through documentation or periodic meetings.",
                    chapter: "Principles"
                },
                
                // Lifecycle Phases (Advanced Questions)
                {
                    question: "During which phase would you expect to see the most significant refinement of the Management Approach Definition?",
                    options: [
                        "Feasibility",
                        "Foundations", 
                        "Exploration",
                        "Post-project"
                    ],
                    correctAnswer: "Exploration",
                    explanation: "While the Management Approach is initially defined in Foundations, it undergoes significant refinement during Exploration as the team gains practical experience with the project's unique challenges.",
                    chapter: "Lifecycle"
                },
                {
                    question: "What is the primary differentiator between the Exploration and Engineering phases in terms of solution development?",
                    options: [
                        "Exploration focuses on technical proof-of-concepts while Engineering focuses on user acceptance",
                        "Exploration delivers the initial business solution while Engineering enhances and refines it",
                        "Exploration uses timeboxes while Engineering uses sequential development",
                        "There is no significant difference between the two phases"
                    ],
                    correctAnswer: "Exploration delivers the initial business solution while Engineering enhances and refines it",
                    explanation: "Exploration delivers the initial usable solution (Minimum Usable Subset), while Engineering focuses on evolving and enhancing this solution based on feedback and additional requirements.",
                    chapter: "Lifecycle"
                },
                {
                    question: "A project discovers a critical technical constraint during the Engineering phase that invalidates the Solution Architecture Definition. What is the appropriate response?",
                    options: [
                        "Continue with the current approach and document the constraint as a known issue",
                        "Immediately escalate to the Business Sponsor for project cancellation",
                        "Return to the Foundations phase to revise the Solution Architecture Definition",
                        "Create a timebox specifically to address the constraint and revise affected deliverables"
                    ],
                    correctAnswer: "Create a timebox specifically to address the constraint and revise affected deliverables",
                    explanation: "AgilePM allows for iterative refinement. When significant issues emerge, dedicated timeboxes should be created to address them while maintaining project momentum.",
                    chapter: "Lifecycle"
                },
                
                // Roles & Responsibilities (Advanced Questions)
                {
                    question: "In a large-scale AgilePM implementation, which role would be responsible for coordinating multiple Team Leaders?",
                    options: [
                        "Business Visionary",
                        "Project Manager", 
                        "Technical Coordinator",
                        "Business Sponsor"
                    ],
                    correctAnswer: "Project Manager",
                    explanation: "The Project Manager coordinates across teams and manages dependencies between Team Leaders in larger implementations.",
                    chapter: "Roles"
                },
                {
                    question: "Which role has the ultimate authority to approve changes to the Prioritized Requirements List during the Delivery phase?",
                    options: [
                        "Business Visionary",
                        "Project Manager",
                        "Business Ambassador", 
                        "Business Sponsor"
                    ],
                    correctAnswer: "Business Visionary",
                    explanation: "The Business Visionary owns the business vision and has ultimate authority over requirement prioritization, though they typically collaborate with the Business Ambassador.",
                    chapter: "Roles"
                },
                {
                    question: "A conflict arises between the Technical Coordinator and Business Ambassador regarding a technical implementation approach. Which role should facilitate resolution?",
                    options: [
                        "Project Manager",
                        "Business Visionary", 
                        "Team Leader",
                        "Workshop Facilitator"
                    ],
                    correctAnswer: "Project Manager",
                    explanation: "The Project Manager is responsible for resolving conflicts and facilitating decision-making between business and technical roles.",
                    chapter: "Roles"
                },
                
                // Products & Artifacts (Advanced Questions)
                {
                    question: "What is the key difference between the Development Approach Definition and Solution Architecture Definition?",
                    options: [
                        "The Development Approach focuses on technical standards while Solution Architecture focuses on business processes",
                        "The Development Approach describes how the solution will be built while Solution Architecture describes what will be built",
                        "The Development Approach is created in Feasibility while Solution Architecture is created in Foundations",
                        "There is no significant difference between the two artifacts"
                    ],
                    correctAnswer: "The Development Approach describes how the solution will be built while Solution Architecture describes what will be built",
                    explanation: "The Development Approach Definition focuses on methods, tools, and processes for development, while the Solution Architecture Definition describes the structure and components of the solution.",
                    chapter: "Products"
                },
                {
                    question: "Which artifact would contain the detailed acceptance criteria for a specific Must Have requirement?",
                    options: [
                        "Prioritized Requirements List",
                        "Business Case", 
                        "Timebox Plan",
                        "Solution Architecture Definition"
                    ],
                    correctAnswer: "Prioritized Requirements List",
                    explanation: "The Prioritized Requirements List contains detailed requirements with their acceptance criteria, prioritized using MoSCoW.",
                    chapter: "Products"
                },
                {
                    question: "During which phase is the Benefits Assessment typically most actively used and updated?",
                    options: [
                        "Feasibility",
                        "Foundations", 
                        "Exploration",
                        "Post-project"
                    ],
                    correctAnswer: "Exploration",
                    explanation: "The Benefits Assessment is actively used during Exploration to validate that delivered increments are achieving expected benefits and to refine benefit projections.",
                    chapter: "Products"
                },
                
                // Planning & Control (Advanced Questions)
                {
                    question: "What is the primary purpose of establishing tolerances at different planning levels in AgilePM?",
                    options: [
                        "To create bureaucratic overhead for change control",
                        "To enable management by exception and empower teams",
                        "To eliminate the need for risk management",
                        "To ensure all plans are perfectly accurate"
                    ],
                    correctAnswer: "To enable management by exception and empower teams",
                    explanation: "Tolerances allow teams to work autonomously within defined boundaries, with escalation only required when tolerances are threatened.",
                    chapter: "Planning"
                },
                {
                    question: "A project is approaching its timebox end with several Should Have requirements incomplete. What is the appropriate action?",
                    options: [
                        "Extend the timebox to complete all Should Have requirements",
                        "Deliver the completed requirements and carry over incomplete ones to the next timebox",
                        "Reduce quality standards to complete all requirements",
                        "Cancel the timebox and restart planning"
                    ],
                    correctAnswer: "Deliver the completed requirements and carry over incomplete ones to the next timebox",
                    explanation: "AgilePM emphasizes delivering value at the end of each timebox. Incomplete Should Have requirements can be reprioritized for future timeboxes.",
                    chapter: "Planning"
                },
                {
                    question: "Which factor should have the LEAST influence on timebox duration in AgilePM?",
                    options: [
                        "Complexity of requirements",
                        "Team velocity and capacity", 
                        "Stakeholder availability for reviews",
                        "The Project Manager's preference"
                    ],
                    correctAnswer: "The Project Manager's preference",
                    explanation: "Timebox duration should be based on objective factors like complexity, team capacity, and stakeholder availability, not personal preferences.",
                    chapter: "Planning"
                },
                
                // Risk & Quality (Advanced Questions)
                {
                    question: "How does AgilePM's approach to quality differ most significantly from traditional approaches?",
                    options: [
                        "Quality is considered less important than speed",
                        "Quality is built in through iterative development and continuous testing",
                        "Quality is only assessed at the end of the project",
                        "Quality is the sole responsibility of testers"
                    ],
                    correctAnswer: "Quality is built in through iterative development and continuous testing",
                    explanation: "AgilePM embeds quality throughout the process via iterative development, continuous testing, and frequent validation rather than leaving it until the end.",
                    chapter: "Quality"
                },
                {
                    question: "Which risk response strategy is most aligned with AgilePM principles when facing uncertain technical requirements?",
                    options: [
                        "Avoidance - eliminate the risky requirements",
                        "Transfer - outsource the development",
                        "Mitigation - build proof-of-concepts and prototypes", 
                        "Acceptance - document the risk and proceed"
                    ],
                    correctAnswer: "Mitigation - build proof-of-concepts and prototypes",
                    explanation: "AgilePM favors active risk mitigation through iterative development, prototyping, and empirical learning rather than avoidance or passive acceptance.",
                    chapter: "Risk"
                },
                {
                    question: "What is the primary purpose of the 'Definition of Done' in AgilePM quality management?",
                    options: [
                        "To document all completed tasks",
                        "To provide a checklist for project closure",
                        "To establish shared understanding of completion criteria", 
                        "To measure individual team member performance"
                    ],
                    correctAnswer: "To establish shared understanding of completion criteria",
                    explanation: "The Definition of Done creates a shared understanding across the team of what 'done' means for any deliverable, ensuring consistent quality standards.",
                    chapter: "Quality"
                },
                
                // Governance & Controls (Advanced Questions)
                {
                    question: "Which governance mechanism provides the earliest indication of potential project issues in AgilePM?",
                    options: [
                        "Monthly steering committee meetings",
                        "End-of-timebox reviews", 
                        "Daily stand-ups",
                        "Formal change requests"
                    ],
                    correctAnswer: "Daily stand-ups",
                    explanation: "Daily stand-ups provide the most frequent and timely visibility into progress and emerging issues, enabling rapid response.",
                    chapter: "Governance"
                },
                {
                    question: "What is the primary value of timeboxing in AgilePM governance?",
                    options: [
                        "It creates rigid deadlines that cannot be changed",
                        "It provides frequent checkpoints for review and adjustment", 
                        "It eliminates the need for other governance mechanisms",
                        "It ensures all work is completed exactly as planned"
                    ],
                    correctAnswer: "It provides frequent checkpoints for review and adjustment",
                    explanation: "Timeboxing creates regular opportunities to inspect progress, gather feedback, and adapt plans based on actual experience.",
                    chapter: "Governance"
                },
                {
                    question: "Which control mechanism is most effective for managing scope creep in AgilePM?",
                    options: [
                        "Detailed change request forms",
                        "Strict MoSCoW prioritization and timebox boundaries", 
                        "Frequent stakeholder meetings",
                        "Comprehensive documentation"
                    ],
                    correctAnswer: "Strict MoSCoW prioritization and timebox boundaries",
                    explanation: "MoSCoW prioritization combined with fixed timebox durations creates natural boundaries that resist scope creep while maintaining flexibility.",
                    chapter: "Governance"
                },
                
                // Communication & Workshops (Advanced Questions)
                {
                    question: "What distinguishes a facilitated workshop from a regular meeting in AgilePM?",
                    options: [
                        "Facilitated workshops are always longer than regular meetings",
                        "Facilitated workshops have a trained facilitator and structured approach", 
                        "Facilitated workshops only involve technical team members",
                        "There is no significant difference between them"
                    ],
                    correctAnswer: "Facilitated workshops have a trained facilitator and structured approach",
                    explanation: "Facilitated workshops are specifically structured events with a trained facilitator to ensure productive collaboration and decision-making.",
                    chapter: "Communication"
                },
                {
                    question: "Which communication approach is most aligned with AgilePM principles for distributed teams?",
                    options: [
                        "Rely primarily on detailed documentation",
                        "Use the richest communication medium possible for each interaction", 
                        "Limit communication to scheduled formal meetings",
                        "Assign one person as the communication coordinator"
                    ],
                    correctAnswer: "Use the richest communication medium possible for each interaction",
                    explanation: "AgilePM emphasizes rich, frequent communication using the most appropriate medium for each context, especially important for distributed teams.",
                    chapter: "Communication"
                },
                {
                    question: "What is the primary purpose of the Daily Stand-up in AgilePM?",
                    options: [
                        "To provide detailed status reporting to management",
                        "To solve complex technical problems",
                        "To synchronize the team and plan the next 24 hours", 
                        "To assign tasks to individual team members"
                    ],
                    correctAnswer: "To synchronize the team and plan the next 24 hours",
                    explanation: "The Daily Stand-up focuses on synchronization and short-term planning, not detailed reporting, problem-solving, or task assignment.",
                    chapter: "Communication"
                },
                {
                    question: "Which factor is most critical for successful workshop facilitation in AgilePM?",
                    options: [
                        "The facilitator's technical expertise",
                        "Strict adherence to the agenda without deviation", 
                        "Creating a safe environment for collaborative discussion",
                        "Comprehensive documentation of all discussions"
                    ],
                    correctAnswer: "Creating a safe environment for collaborative discussion",
                    explanation: "Psychological safety and collaborative environment are foundational to effective workshops where all participants can contribute openly.",
                    chapter: "Communication"
                }
            ]
        };

        // DOM Elements
        const questionCounterEl = document.getElementById('question-counter');
        const currentScoreEl = document.getElementById('current-score');
        const progressBarEl = document.getElementById('progress-bar');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const explanationBoxEl = document.getElementById('explanation-box');
        const explanationTitleEl = document.getElementById('explanation-title');
        const explanationTextEl = document.getElementById('explanation-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const finishBtn = document.getElementById('finish-btn');
        
        // Modal Elements
        const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
        const finalScoreCorrectEl = document.getElementById('final-score-correct');
        const finalScoreTotalEl = document.getElementById('final-score-total');
        const finalScorePercentageEl = document.getElementById('final-score-percentage');
        const finalRecommendationsEl = document.getElementById('final-recommendations');
        const passFailMessageEl = document.getElementById('pass-fail-message');
        const chapterAnalysisContainer = document.getElementById('chapter-analysis-container');
        const strengthsList = document.getElementById('strengths-list');
        const weaknessesList = document.getElementById('weaknesses-list');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');

        // Quiz State
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let questions = [];
        let chapterPerformance = {};

        function initializeChapterPerformance() {
            const chapters = ["Principles", "Lifecycle", "Roles", "Products", "Planning", "Quality", "Risk", "Governance", "Communication"];
            chapterPerformance = {};
            chapters.forEach(chapter => {
                chapterPerformance[chapter] = {
                    correct: 0,
                    total: 0,
                    percentage: 0
                };
            });
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startQuiz() {
            questions = shuffleArray([...quizData.questions]);
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = new Array(questions.length).fill(null);
            initializeChapterPerformance();
            displayQuestion(currentQuestionIndex);
            updateScoreDisplay();
            resultsModal.hide();
        }

        function displayQuestion(index) {
            // Hide explanation from previous question
            explanationBoxEl.classList.add('d-none');
            
            const question = questions[index];
            questionTextEl.textContent = question.question;
            
            // Clear previous options
            optionsContainerEl.innerHTML = '';
            
            // Display options
            question.options.forEach(optionText => {
                const button = document.createElement('button');
                button.textContent = optionText;
                button.classList.add('btn', 'option-btn');
                button.onclick = () => selectAnswer(button, optionText, index);
                optionsContainerEl.appendChild(button);
            });
            
            updateNavigation();
            updateProgressBar();
            
            // If the user has already answered this question, show their answer
            if (userAnswers[index] !== null) {
                showAnswerFeedback(index);
            }
        }
        
        function selectAnswer(button, selectedAnswer, questionIndex) {
            // Prevent re-answering
            if (userAnswers[questionIndex] !== null) return;
            
            const question = questions[questionIndex];
            const isCorrect = selectedAnswer === question.correctAnswer;
            
            userAnswers[questionIndex] = {
                selected: selectedAnswer,
                correct: question.correctAnswer,
                isCorrect: isCorrect,
                chapter: question.chapter
            };
            
            // Update chapter performance
            chapterPerformance[question.chapter].total++;
            if(isCorrect) {
                score++;
                chapterPerformance[question.chapter].correct++;
            }
            
            updateScoreDisplay();
            showAnswerFeedback(questionIndex);
        }

        function showAnswerFeedback(index) {
            const userAnswer = userAnswers[index];
            if (!userAnswer) return;

            const question = questions[index];

            // Disable all option buttons
            const optionButtons = optionsContainerEl.querySelectorAll('.option-btn');
            optionButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === userAnswer.correct) {
                    btn.classList.add('correct');
                } else if (btn.textContent === userAnswer.selected) {
                    btn.classList.add('incorrect');
                }
            });

            // Show explanation
            explanationTextEl.textContent = question.explanation;
            if (userAnswer.isCorrect) {
                explanationTitleEl.textContent = "Correct!";
                explanationBoxEl.className = 'explanation-correct';
            } else {
                explanationTitleEl.textContent = "Explanation:";
                explanationBoxEl.className = 'explanation-incorrect';
            }
            explanationBoxEl.classList.remove('d-none');
        }

        function updateNavigation() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.classList.toggle('d-none', currentQuestionIndex === questions.length - 1);
            finishBtn.classList.toggle('d-none', currentQuestionIndex !== questions.length - 1);
        }

        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBarEl.style.width = `${progress}%`;
            progressBarEl.setAttribute('aria-valuenow', progress);
            questionCounterEl.textContent = `Question ${currentQuestionIndex + 1} / ${questions.length}`;
        }
        
        function updateScoreDisplay() {
            currentScoreEl.textContent = `Score: ${score}`;
        }

        function handleNext() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
            }
        }

        function handlePrev() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex);
            }
        }

        function calculateChapterPerformance() {
            // Calculate percentages for each chapter
            Object.keys(chapterPerformance).forEach(chapter => {
                const data = chapterPerformance[chapter];
                if (data.total > 0) {
                    data.percentage = Math.round((data.correct / data.total) * 100);
                }
            });
        }

        function getPerformanceColor(percentage) {
            if (percentage >= 80) return 'success';
            if (percentage >= 60) return 'warning';
            return 'danger';
        }

        function showFinalResults() {
            calculateChapterPerformance();
            const percentage = (score / questions.length) * 100;
            const passed = percentage >= 70; // Higher threshold for advanced assessment
            let scoreColor;
            let recommendationsHtml;
            let passFailHtml;

            if (passed) {
                scoreColor = 'var(--success-color)';
                passFailHtml = '<div class="alert alert-success"><i class="fas fa-trophy"></i> <strong>Excellent!</strong> You demonstrate advanced AgilePM knowledge.</div>';
                recommendationsHtml = '<p>Your performance indicates strong understanding of AgilePM concepts. Consider preparing for the Practitioner level certification.</p>';
            } else {
                scoreColor = 'var(--danger-color)';
                passFailHtml = '<div class="alert alert-danger"><i class="fas fa-graduation-cap"></i> <strong>Good effort!</strong> Focus on the identified improvement areas.</div>';
                recommendationsHtml = '<p>Review the AgilePM Foundation syllabus with special attention to your weaker areas. Practice with more scenario-based questions.</p>';
            }

            finalScoreCorrectEl.textContent = score;
            finalScoreTotalEl.textContent = questions.length;
            finalScorePercentageEl.textContent = `${percentage.toFixed(0)}%`;
            finalScorePercentageEl.style.color = scoreColor;
            passFailMessageEl.innerHTML = passFailHtml;
            finalRecommendationsEl.innerHTML = recommendationsHtml;

            // Generate chapter analysis
            generateChapterAnalysis();
            
            // Generate strengths and weaknesses
            generateStrengthsWeaknesses();

            resultsModal.show();
        }

        function generateChapterAnalysis() {
            let analysisHtml = '<div class="chapter-analysis">';
            
            Object.keys(chapterPerformance).forEach(chapter => {
                const data = chapterPerformance[chapter];
                if (data.total > 0) {
                    const color = getPerformanceColor(data.percentage);
                    analysisHtml += `
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>${chapter}</span>
                                <span class="fw-bold text-${color}">${data.percentage}%</span>
                            </div>
                            <div class="progress chapter-progress">
                                <div class="progress-bar bg-${color}" role="progressbar" style="width: ${data.percentage}%" aria-valuenow="${data.percentage}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small class="text-muted">${data.correct}/${data.total} correct</small>
                        </div>
                    `;
                }
            });
            
            analysisHtml += '</div>';
            chapterAnalysisContainer.innerHTML = analysisHtml;
        }

        function generateStrengthsWeaknesses() {
            let strengthsHtml = '';
            let weaknessesHtml = '';
            
            Object.keys(chapterPerformance).forEach(chapter => {
                const data = chapterPerformance[chapter];
                if (data.total > 0) {
                    if (data.percentage >= 80) {
                        strengthsHtml += `<div class="strength-weakness strength">${chapter} (${data.percentage}%)</div>`;
                    } else if (data.percentage < 60) {
                        weaknessesHtml += `<div class="strength-weakness weakness">${chapter} (${data.percentage}%)</div>`;
                    }
                }
            });
            
            if (strengthsHtml === '') {
                strengthsHtml = '<div class="text-muted">No clear strengths identified. Focus on fundamental concepts.</div>';
            }
            
            if (weaknessesHtml === '') {
                weaknessesHtml = '<div class="text-muted">No major weaknesses identified. Good overall understanding.</div>';
            }
            
            strengthsList.innerHTML = strengthsHtml;
            weaknessesList.innerHTML = weaknessesHtml;
        }

        // Event Listeners
        nextBtn.addEventListener('click', handleNext);
        prevBtn.addEventListener('click', handlePrev);
        finishBtn.addEventListener('click', showFinalResults);
        restartQuizBtn.addEventListener('click', () => {
            resultsModal.hide();
            // A short delay to allow modal to close before restarting
            setTimeout(startQuiz, 500);
        });
        
        // Initial call
        document.addEventListener('DOMContentLoaded', startQuiz);
    </script>
</body>
</html>
